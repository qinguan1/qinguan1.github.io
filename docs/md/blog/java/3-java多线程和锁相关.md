## javaå¤šçº¿ç¨‹å’Œé”ç›¸å…³

ä½œè€…ï¼šqinguan
`<br/>`åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

> æ•…ä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œï¼›ä¸ç§¯å°æµï¼Œæ— ä»¥æˆæ±Ÿæµ·ï¼ğŸŒ»

#### 1.**ä»€ä¹ˆæ˜¯è¿›ç¨‹**?

è¿›ç¨‹æ˜¯ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªç¨‹åºï¼Œç¨‹åºä¸€æ—¦è¿è¡Œå°±æ˜¯è¿›ç¨‹ã€‚

è¿›ç¨‹å¯ä»¥çœ‹æˆç¨‹åºæ‰§è¡Œçš„ä¸€ä¸ªå®ä¾‹ã€‚è¿›ç¨‹æ˜¯ç³»ç»Ÿèµ„æºåˆ†é…çš„ç‹¬ç«‹å®ä½“ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚ä¸€ä¸ªè¿›ç¨‹æ— æ³•è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„å˜é‡å’Œæ•°æ®ç»“æ„ï¼Œå¦‚æœæƒ³è®©ä¸€ä¸ªè¿›ç¨‹è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„èµ„æºï¼Œéœ€è¦ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡ï¼Œæ¯”å¦‚ç®¡é“ï¼Œæ–‡ä»¶ï¼Œå¥—æ¥å­—ç­‰ã€‚

**è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡**ï¼š

1ã€ åŒä¸€å°è®¡ç®—æœºå†…é€šè®¯ç§°ä¸ºï¼šIPC

2ã€ä¸åŒè®¡ç®—æœºä¹‹é—´åˆ™éœ€è¦é€šè¿‡ç½‘ç»œï¼Œå¹¶éµå®ˆåŒæ ·çš„åè®®ï¼Œä¾‹å¦‚ï¼šHTTP

#### 2.ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ

æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ã€‚å®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ã€‚ä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚

è¿›ç¨‹æ˜¯ `èµ„æºåˆ†é…`çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯ `è°ƒåº¦`çš„æœ€å°å•ä½ã€‚

ä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºå¤šä¸ªçº¿ç¨‹ï¼Œåœ¨windowsä¸­ï¼Œè¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œåªæ˜¯ä½œä¸ºçº¿ç¨‹çš„å®¹å™¨ã€‚

#### 3.çº¿ç¨‹çš„å®ç°æ–¹å¼?

> 1. ç»§æ‰¿Threadç±»
> 2. å®ç°Runnableæ¥å£
> 3. ä½¿ç”¨Callableå’ŒFuture

#### 4.**Thread ç±»ä¸­çš„start() å’Œ run() æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«**?

1.startï¼ˆï¼‰æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼ŒçœŸæ­£å®ç°äº†å¤šçº¿ç¨‹è¿è¡Œã€‚è¿™æ—¶æ— éœ€ç­‰å¾…runæ–¹æ³•ä½“ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¯ä»¥ç›´æ¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼›é€šè¿‡è°ƒç”¨Threadç±»çš„start()æ–¹æ³•æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œ è¿™æ—¶æ­¤çº¿ç¨‹æ˜¯å¤„äºå°±ç»ªçŠ¶æ€ï¼Œ å¹¶æ²¡æœ‰è¿è¡Œã€‚ ç„¶åé€šè¿‡æ­¤Threadç±»è°ƒç”¨æ–¹æ³•run()æ¥å®Œæˆå…¶è¿è¡Œæ“ä½œçš„ï¼Œ è¿™é‡Œæ–¹æ³•run()ç§°ä¸ºçº¿ç¨‹ä½“ï¼Œå®ƒåŒ…å«äº†è¦æ‰§è¡Œçš„è¿™ä¸ªçº¿ç¨‹çš„å†…å®¹ï¼Œ Runæ–¹æ³•è¿è¡Œç»“æŸï¼Œ æ­¤çº¿ç¨‹ç»ˆæ­¢ã€‚ç„¶åCPUå†è°ƒåº¦å…¶å®ƒçº¿ç¨‹ã€‚
2.runï¼ˆï¼‰æ–¹æ³•å½“ä½œæ™®é€šæ–¹æ³•çš„æ–¹å¼è°ƒç”¨ã€‚ç¨‹åºè¿˜æ˜¯è¦é¡ºåºæ‰§è¡Œï¼Œè¦ç­‰å¾…runæ–¹æ³•ä½“æ‰§è¡Œå®Œæ¯•åï¼Œæ‰å¯ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼› ç¨‹åºä¸­åªæœ‰ä¸»çº¿ç¨‹â€”â€”è¿™ä¸€ä¸ªçº¿ç¨‹ï¼Œ å…¶ç¨‹åºæ‰§è¡Œè·¯å¾„è¿˜æ˜¯åªæœ‰ä¸€æ¡ï¼Œ è¿™æ ·å°±æ²¡æœ‰è¾¾åˆ°å†™çº¿ç¨‹çš„ç›®çš„ã€‚

#### 5.çº¿ç¨‹NEWçŠ¶æ€

newåˆ›å»ºä¸€ä¸ªThreadå¯¹è±¡æ—¶ï¼Œå¹¶æ²¡å¤„äºæ‰§è¡ŒçŠ¶æ€ï¼Œå› ä¸ºæ²¡æœ‰è°ƒç”¨startæ–¹æ³•å¯åŠ¨æ”¹çº¿ç¨‹ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„çŠ¶æ€å°±æ˜¯æ–°å»ºçŠ¶æ€ã€‚

#### 6.çº¿ç¨‹RUNNABLEçŠ¶æ€

çº¿ç¨‹å¯¹è±¡é€šè¿‡startæ–¹æ³•è¿›å…¥runnableçŠ¶æ€ï¼Œå¯åŠ¨çš„çº¿ç¨‹ä¸ä¸€å®šä¼šç«‹å³å¾—åˆ°æ‰§è¡Œï¼Œçº¿ç¨‹çš„è¿è¡Œä¸å¦è¦çœ‹cpuçš„è°ƒåº¦ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªä¸­é—´çŠ¶æ€å«å¯æ‰§è¡ŒçŠ¶æ€ï¼ˆRUNNABLE)ã€‚

#### 7.çº¿ç¨‹çš„RUNNINGçŠ¶æ€

ä¸€æ—¦cpué€šè¿‡è½®è¯¢è´§å…¶ä»–æ–¹å¼ä»ä»»åŠ¡å¯ä»¥æ‰§è¡Œé˜Ÿåˆ—ä¸­é€‰ä¸­äº†çº¿ç¨‹ï¼Œæ­¤æ—¶å®ƒæ‰èƒ½çœŸæ­£çš„æ‰§è¡Œè‡ªå·±çš„é€»è¾‘ä»£ç ã€‚

#### 8.çº¿ç¨‹çš„BLOCKEDçŠ¶æ€

çº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–é”ã€‚

- è¿›å…¥BLOCKEDçŠ¶æ€ï¼Œæ¯”å¦‚è°ƒç”¨äº†sleep,æˆ–è€…waitæ–¹æ³•
- è¿›è¡ŒæŸä¸ªé˜»å¡çš„ioæ“ä½œï¼Œæ¯”å¦‚å› ç½‘ç»œæ•°æ®çš„è¯»å†™è¿›å…¥BLOCKEDçŠ¶æ€
- è·å–æŸä¸ªé”èµ„æºï¼Œä»è€ŒåŠ å…¥åˆ°è¯¥é”çš„é˜»å¡é˜Ÿåˆ—ä¸­è€Œè¿›å…¥BLOCKEDçŠ¶æ€

#### 9.çº¿ç¨‹çš„TERMINATEDçŠ¶æ€

TERMINATEDæ˜¯ä¸€ä¸ªçº¿ç¨‹çš„æœ€ç»ˆçŠ¶æ€ï¼Œåœ¨è¯¥çŠ¶æ€ä¸‹çº¿ç¨‹ä¸ä¼šå†åˆ‡æ¢åˆ°å…¶ä»–ä»»ä½•çŠ¶æ€äº†ï¼Œä»£è¡¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸéƒ½ç»“æŸäº†ã€‚

ä¸‹é¢å‡ ç§æƒ…å†µä¼šè¿›å…¥TERMINATEDçŠ¶æ€:

- çº¿ç¨‹è¿è¡Œæ­£å¸¸ç»“æŸï¼Œç»“æŸç”Ÿå‘½å‘¨æœŸ
- çº¿ç¨‹è¿è¡Œå‡ºé”™æ„å¤–ç»“æŸ
- JVM Crash å¯¼è‡´æ‰€æœ‰çš„çº¿ç¨‹éƒ½ç»“æŸ

#### 10.çº¿ç¨‹çŠ¶æ€è½¬åŒ–å›¾

![image-20200501131131886](https://gitee.com/yizhibuerdai/Imagetools/raw/master/images/image-20200501131131886.png)

#### 11.i--ä¸System.out.println()çš„å¼‚å¸¸

ç¤ºä¾‹ä»£ç :

```java
public class XkThread extends Thread {

    private int i = 5;

    @Override
    public void run() {
       System.out.println("i=" + (i--) + " threadName=" + Thread.currentThread().getName());
    }

    public static void main(String[] args) {
        XkThread xk = new XkThread();
        Thread t1 = new Thread(xk);
        Thread t2 = new Thread(xk);
        Thread t3 = new Thread(xk);
        Thread t4 = new Thread(xk);
        Thread t5 = new Thread(xk);

        t1.start();
        t2.start();
        t3.start();
        t4.start();
        t5.start();
    }
}

```

ç»“æœ:

```tex
i=5 threadName=Thread-1
i=2 threadName=Thread-5
i=5 threadName=Thread-2
i=4 threadName=Thread-3
i=3 threadName=Thread-4
```

è™½ç„¶println()æ–¹æ³•åœ¨å†…éƒ¨æ˜¯åŒæ­¥çš„ï¼Œä½†i--çš„æ“ä½œå´æ˜¯åœ¨è¿›å…¥println()ä¹‹å‰å‘ç”Ÿçš„ï¼Œæ‰€ä»¥æœ‰å‘ç”Ÿéçº¿ç¨‹å®‰å…¨çš„æ¦‚ç‡ã€‚

 println()æºç :

```java
    public void println(String x) {
        synchronized (this) {
            print(x);
            newLine();
        }
    }
```

#### 12.å¦‚ä½•çŸ¥é“ä»£ç æ®µè¢«å“ªä¸ªçº¿ç¨‹è°ƒç”¨ï¼Ÿ

```java
   System.out.println(Thread.currentThread().getName());
```

#### 13.çº¿ç¨‹æ´»åŠ¨çŠ¶æ€ï¼Ÿ

```java
public class XKThread extends Thread {

    @Override
    public void run() {
        System.out.println("run run run is "  + this.isAlive() );
    }

    public static void main(String[] args) {
        XKThread xk = new XKThread();
        System.out.println("begin â€”â€”â€” " + xk.isAlive());
        xk.start();
        System.out.println("end â€”â€”â€”â€”â€” " + xk.isAlive());

    }
}

```

#### 14.sleep()æ–¹æ³•

æ–¹æ³•sleep()çš„ä½œç”¨æ˜¯åœ¨æŒ‡å®šçš„æ¯«ç§’æ•°å†…è®©å½“å‰çš„â€œæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹â€ä¼‘çœ ï¼ˆæš‚åœæ‰§è¡Œï¼‰ã€‚

#### 15.å¦‚ä½•ä¼˜é›…çš„è®¾ç½®ç¡çœ æ—¶é—´?

jdk1.5 åï¼Œå¼•å…¥äº†ä¸€ä¸ªæšä¸¾TimeUnit,å¯¹sleepæ–¹æ³•æä¾›äº†å¾ˆå¥½çš„å°è£…ã€‚

æ¯”å¦‚è¦è¡¨è¾¾2å°æ—¶22åˆ†55ç§’899æ¯«ç§’ã€‚

```java
Thread.sleep(8575899L);
TimeUnit.HOURS.sleep(3);
TimeUnit.MINUTES.sleep(22);
TimeUnit.SECONDS.sleep(55);
TimeUnit.MILLISECONDS.sleep(899);
```

å¯ä»¥çœ‹åˆ°è¡¨è¾¾çš„å«ä¹‰æ›´æ¸…æ™°ï¼Œæ›´ä¼˜é›…ã€‚

#### 16.åœæ­¢çº¿ç¨‹

runæ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè‡ªç„¶ç»ˆæ­¢ã€‚

stop()æ–¹æ³•ï¼Œsuspend()ä»¥åŠresume()éƒ½æ˜¯è¿‡æœŸä½œåºŸæ–¹æ³•ï¼Œä½¿ç”¨å®ƒä»¬ç»“æœä¸å¯é¢„æœŸã€‚

å¤§å¤šæ•°åœæ­¢ä¸€ä¸ªçº¿ç¨‹çš„æ“ä½œä½¿ç”¨Thread.interrupt()ç­‰äºè¯´ç»™çº¿ç¨‹æ‰“ä¸€ä¸ªåœæ­¢çš„æ ‡è®°, æ­¤æ–¹æ³•ä¸å›å»ç»ˆæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œéœ€è¦åŠ å…¥ä¸€ä¸ªåˆ¤æ–­æ‰èƒ½å¯ä»¥å®Œæˆçº¿ç¨‹çš„åœæ­¢ã€‚

#### 17.interruptï¼Œinterrupted å’Œ isInterrupted

interruptï¼šä¸ºå½“å‰çº¿ç¨‹è®¾ç½®ä¸€ä¸ªä¸­æ–­æ ‡å¿—ï¼Œå½“å‰çº¿ç¨‹ä¾æ—§å¯ä»¥ç»§ç»­è¿è¡Œ

interrupted:  é™æ€æ–¹æ³•ï¼Œåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­,ä¼šé‡ç½®å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€

isInterruptedï¼šå®ä¾‹æ–¹æ³•ï¼Œåˆ¤æ–­çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­ï¼Œä¸ä¼šé‡ç½®å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€

#### 18.yield

æ”¾å¼ƒå½“å‰cpuèµ„æºï¼Œå°†å®ƒè®©ç»™å…¶ä»–çš„ä»»åŠ¡å ç”¨cpuæ‰§è¡Œæ—¶é—´ã€‚ä½†æ”¾å¼ƒçš„æ—¶é—´ä¸ç¡®å®šï¼Œæœ‰å¯èƒ½åˆšåˆšæ”¾å¼ƒï¼Œé©¬ä¸Šåˆè·å¾—cpuæ—¶é—´ç‰‡ã€‚

æµ‹è¯•ä»£ç :(cpuç‹¬å æ—¶é—´ç‰‡)

```java
public class XKThread extends Thread {

    @Override
    public void run() {
        long beginTime = System.currentTimeMillis();
        int count = 0;
        for (int i = 0; i < 50000000; i++) {
            count = count + (i + 1);
        }
        long endTime = System.currentTimeMillis();
        System.out.println("ç”¨æ—¶ = " + (endTime - beginTime) + " æ¯«ç§’! ");
    }

    public static void main(String[] args) {
        XKThread xkThread = new XKThread();
        xkThread.start();
    }
}
```

ç»“æœï¼š

```tex
ç”¨æ—¶ = 20 æ¯«ç§’! 
```

åŠ å…¥yieldï¼Œå†æ¥æµ‹è¯•ã€‚(cpuè®©ç»™å…¶ä»–èµ„æºå¯¼è‡´é€Ÿåº¦å˜æ…¢)

```java
public class XKThread extends Thread {

    @Override
    public void run() {
        long beginTime = System.currentTimeMillis();
        int count = 0;
        for (int i = 0; i < 50000000; i++) {
            Thread.yield();
            count = count + (i + 1);
        }
        long endTime = System.currentTimeMillis();
        System.out.println("ç”¨æ—¶ = " + (endTime - beginTime) + " æ¯«ç§’! ");
    }

    public static void main(String[] args) {
        XKThread xkThread = new XKThread();
        xkThread.start();
    }

}

```

ç»“æœ:

```tex
ç”¨æ—¶ = 38424 æ¯«ç§’! 
```

#### 19.çº¿ç¨‹çš„ä¼˜å…ˆçº§

åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹å¯ä»¥åˆ’åˆ†ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¾ƒé«˜çš„çº¿ç¨‹å¾—åˆ°cpuèµ„æºæ¯”è¾ƒå¤šï¼Œä¹Ÿå°±æ˜¯cpuæœ‰é™æ‰§è¡Œä¼˜å…ˆçº§è¾ƒé«˜çš„çº¿ç¨‹å¯¹è±¡ä¸­çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯ä¸€å®šä¼˜å…ˆçº§é«˜ï¼Œå°±å…ˆæ‰§è¡Œã€‚

Javaçš„ä¼˜å…ˆçº§åˆ†ä¸º1ï½10ä¸ªç­‰çº§ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œé»˜è®¤ä¼˜å…ˆçº§å¤§å°ä¸º5ã€‚è¶…å‡ºèŒƒå›´åˆ™æŠ›å‡ºï¼šjava.lang.IllegalArgumentExceptionã€‚

#### 20.ä¼˜å…ˆçº§ç»§æ‰¿ç‰¹æ€§

çº¿ç¨‹çš„ä¼˜å…ˆçº§å…·æœ‰ç»§æ‰¿æ€§ï¼Œæ¯”å¦‚açº¿ç¨‹å¯åŠ¨bçº¿ç¨‹ï¼Œbçº¿ç¨‹ä¸aä¼˜å…ˆçº§æ˜¯ä¸€æ ·çš„ã€‚

#### 21.è°è·‘çš„æ›´å¿«ï¼Ÿ

è®¾ç½®ä¼˜å…ˆçº§é«˜ä½ä¸¤ä¸ªçº¿ç¨‹ï¼Œç´¯åŠ æ•°å­—ï¼Œçœ‹è°è·‘çš„å¿«ï¼Œä¸Šä»£ç ã€‚

```java
public class Run extends Thread{

    public static void main(String[] args) {
        try {
            ThreadLow low = new ThreadLow();
            low.setPriority(2);
            low.start();

            ThreadHigh high = new ThreadHigh();
            high.setPriority(8);
            high.start();

            Thread.sleep(2000);
            low.stop();
            high.stop();
            System.out.println("low  = " + low.getCount());
            System.out.println("high = " + high.getCount());
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

    }

}

class ThreadHigh extends Thread {
    private int count = 0;

    public int getCount() {
        return count;
    }


    @Override
    public void run() {
        while (true) {
            count++;
        }
    }
}

class ThreadLow extends Thread {
    private int count = 0;

    public int getCount() {
        return count;
    }


    @Override
    public void run() {
        while (true) {
            count++;
        }
    }
}
```

ç»“æœ:

```tex
low  = 1193854568
high = 1204372373

```

#### 22.çº¿ç¨‹ç§ç±»

Javaçº¿ç¨‹æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œä¸€ç§æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚

#### 23.å®ˆæŠ¤çº¿ç¨‹çš„ç‰¹ç‚¹

å®ˆæŠ¤çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„çº¿ç¨‹ï¼Œä¸»è¦è¢«ç”¨åšç¨‹åºä¸­åå°è°ƒåº¦ä»¥åŠæ”¯æŒæ€§å·¥ä½œã€‚å½“Javaè™šæ‹Ÿæœºä¸­ä¸å­˜åœ¨éå®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹æ‰ä¼šéšç€JVMä¸€åŒç»“æŸå·¥ä½œã€‚

#### 24.Javaä¸­å…¸å‹çš„å®ˆæŠ¤çº¿ç¨‹

GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰

#### 25.å¦‚ä½•è®¾ç½®å®ˆæŠ¤çº¿ç¨‹

Thread.setDaemon(true)

PS:Daemonå±æ€§éœ€è¦å†å¯åŠ¨çº¿ç¨‹ä¹‹å‰è®¾ç½®ï¼Œä¸èƒ½å†å¯åŠ¨åè®¾ç½®ã€‚

#### 25.Javaè™šæ‹Ÿæœºé€€å‡ºæ—¶Daemonçº¿ç¨‹ä¸­çš„finallyå—ä¸€å®šä¼šæ‰§è¡Œï¼Ÿ

Javaè™šæ‹Ÿæœºé€€å‡ºæ—¶Daemonçº¿ç¨‹ä¸­çš„finallyå—å¹¶ä¸ä¸€å®šä¼šæ‰§è¡Œã€‚

ä»£ç ç¤ºä¾‹:

```java
public class XKDaemon {
    public static void main(String[] args) {
        Thread thread = new Thread(new DaemonRunner(),"xkDaemonRunner");
        thread.setDaemon(true);
        thread.start();

    }

    static class DaemonRunner implements Runnable {

        @Override
        public void run() {
            try {
                SleepUtils.sleep(10);
            } finally {
                System.out.println("Javaå°å’–ç§€ daemonThread finally run â€¦");
            }

        }
    }
}
```

ç»“æœï¼š

```

```

 æ²¡æœ‰ä»»ä½•çš„è¾“å‡ºï¼Œè¯´æ˜æ²¡æœ‰æ‰§è¡Œfinallyã€‚

#### 26.è®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨

è·å–çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨

```java
public ClassLoader getContextClassLoader() 
```

è®¾ç½®çº¿ç¨‹ç±»åŠ è½½å™¨ï¼ˆå¯ä»¥æ‰“ç ´Javaç±»åŠ è½½å™¨çš„çˆ¶ç±»å§”æ‰˜æœºåˆ¶ï¼‰

```java
public void setContextClassLoader(ClassLoader cl)
```

#### 27.join

joinæ˜¯æŒ‡æŠŠæŒ‡å®šçš„çº¿ç¨‹åŠ å…¥åˆ°å½“å‰çº¿ç¨‹ï¼Œæ¯”å¦‚joinæŸä¸ªçº¿ç¨‹a,ä¼šè®©å½“å‰çº¿ç¨‹bè¿›å…¥ç­‰å¾…,ç›´åˆ°açš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œæ­¤æœŸé—´bçº¿ç¨‹æ˜¯å¤„äºblockedçŠ¶æ€ã€‚

#### 28.ä»€ä¹ˆæ˜¯synchronized?

synchronizedå…³é”®å­—å¯ä»¥æ—¶é—´ä¸€ä¸ªç®€å•çš„ç­–ç•¥æ¥é˜²æ­¢çº¿ç¨‹å¹²æ‰°å’Œå†…å­˜ä¸€è‡´æ€§é”™è¯¯ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯å¯¹å¤šä¸ªçº¿ç¨‹å¯è§çš„ï¼Œé‚£ä¹ˆå¯¹è¯¥å¯¹æƒ³çš„æ‰€æœ‰è¯»å†™éƒ½å°†é€šè¿‡åŒæ­¥çš„æ–¹å¼æ¥è¿›è¡Œã€‚

#### 29.synchronizedåŒ…æ‹¬å“ªä¸¤ä¸ªjvmé‡è¦çš„æŒ‡ä»¤ï¼Ÿ

monitor enter å’Œ monitor exit

#### 30.synchronizedå…³é”®å­—ç”¨æ³•?

å¯ä»¥ç”¨äºå¯¹ä»£ç å—æˆ–æ–¹æ³•çš„ä¿®é¥°

#### 31.synchronizedé”çš„æ˜¯ä»€ä¹ˆ?

æ™®é€šåŒæ­¥æ–¹æ³• -> é”çš„æ˜¯å½“å‰å®åŠ›å¯¹è±¡ã€‚

é™æ€åŒæ­¥æ–¹æ³• -> é”çš„æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ã€‚

åŒæ­¥æ–¹æ³•å¿« -> é”çš„æ˜¯synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡ã€‚

#### 32.Javaå¯¹è±¡å¤´

synchronizedç”¨çš„é”æ˜¯å­˜åœ¨Javaå¯¹è±¡å¤´é‡Œçš„ã€‚å¯¹è±¡å¦‚æœæ˜¯æ•°ç»„ç±»å‹ï¼Œè™šæ‹Ÿæœºç”¨3ä¸ªå­—å®½(Word)å­˜å‚¨å¯¹è±¡å¤´ï¼Œå¦‚æœå¯¹è±¡æ˜¯éæ•°ç»„ç±»å‹ï¼Œç”¨2å­—å®½å­˜å‚¨å¯¹è±¡å¤´ã€‚

Tips:32ä½è™šæ‹Ÿæœºä¸­ä¸€ä¸ªå­—å®½ç­‰äº4å­—èŠ‚ã€‚

#### 33.Javaå¯¹è±¡å¤´é•¿åº¦

![image-20200418215447539](https://gitee.com/yizhibuerdai/Imagetools/raw/master/images/image-20200418215447539.png)

#### 34.Javaå¯¹è±¡å¤´çš„å­˜å‚¨ç»“æ„

 32ä½JVMçš„Mark Word é»˜è®¤å­˜å‚¨ç»“æ„

![image-20200418220122794](https://gitee.com/yizhibuerdai/Imagetools/raw/master/images/image-20200418220122794.png)

#### 35.Mark Wordçš„çŠ¶æ€å˜åŒ–

Mark Word å­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä¸ºçš„å˜åŒ–è€Œå˜åŒ–ã€‚

![image-20200418220322880](https://gitee.com/yizhibuerdai/Imagetools/raw/master/images/image-20200418220322880.png)

64ä½è™šæ‹Ÿæœºä¸‹ï¼ŒMark Wordæ˜¯64bitå¤§å°çš„

![image-20200418224055558](https://gitee.com/yizhibuerdai/Imagetools/raw/master/images/image-20200418224055558.png)

#### 36.synchronizedé”çš„å‡é™çº§è§„åˆ™

Java SE 1.6 ä¸ºäº†æé«˜synchronizedé”çš„æ€§èƒ½ã€‚å¼•å…¥äº†â€œåå‘é”â€å’Œè½»é‡çº§é”â€œã€‚

Java SE 1.6 ä¸­synchronizedé”æœ‰4ç§çŠ¶æ€ã€‚çº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€ã€‚

***é”åªèƒ½å‡çº§ä¸èƒ½é™çº§***

#### 37.åå‘é”

å¤§å¤šæ•°æƒ…å†µï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­è®°å½•å­˜å‚¨é”åå‘çš„çº¿ç¨‹ID,ä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡Œ casæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´ Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æœæµ‹è¯•æˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™éœ€è¦æµ‹è¯•ä¸‹Mark Wordä¸­åå‘é”çš„æ ‡ç¤ºæ˜¯å¦å·²ç»è®¾ç½®æˆ1ï¼ˆè¡¨ç¤ºå½“å‰æ—¶åå‘é”),å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨casç«äº‰é”ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œåˆ™å°è¯•ä½¿ç”¨caså°†å¯¹è±¡å¤´çš„åå‘é”åªæƒ³å½“å‰çº¿ç¨‹ã€‚

#### 38.å…³é—­åå‘é”å»¶è¿Ÿ

java6å’Œ7ä¸­é»˜è®¤å¯ç”¨ï¼Œä½†æ˜¯ä¼šåœ¨ç¨‹åºå¯åŠ¨å‡ ç§’åæ‰æ¿€æ´»ï¼Œå¦‚æœéœ€è¦å…³é—­å»¶è¿Ÿï¼Œ

-XX:BiasedLockingStartupDelay=0ã€‚

#### 39.å¦‚ä½•å…³é—­åå‘é”

JVMå‚æ•°å…³é—­åå‘é”:-XX:-UseBiasedLocking=false,é‚£ä¹ˆç¨‹åºé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚

Tips:å¦‚æœä½ å¯ä»¥ç¡®å®šç¨‹åºçš„æ‰€æœ‰é”é€šå¸¸æƒ…å†µå¤„äºç«æ€ï¼Œåˆ™å¯ä»¥é€‰æ‹©å…³é—­ã€‚

#### 40.è½»é‡çº§é”

çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ï¼Œjvmä¼šç°åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºç”¨äºå‚¨å­˜é”è®°å½•çš„ç©ºé—´ã€‚å¹¶å°†å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ç„¶åçº¿ç¨‹å°è¯•ä½¿ç”¨caså°†å¯¹è±¡å¤´ä¸­çš„Mark Wordæ›¿æ¢ä¸ºä¹‹ä¹¡é”è®°å½•çš„æŒ‡é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚

#### 41.è½»é‡é”çš„è§£é”

è½»é‡é”è§£é”æ—¶ï¼Œä¼šä½¿åŸå­æ“ä½œcaså°† displaced Mark Word æ›¿æ¢å›å¯¹è±¡å¤´ï¼Œå¦‚æœæˆåŠŸåˆ™è¡¨ç¤ºæ²¡æœ‰ç«äº‰å‘ç”Ÿï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå­˜åœ¨ç«äº‰ï¼Œæ­¤æ—¶é”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚

#### 42.é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”

![image-20200419110938271](https://gitee.com/yizhibuerdai/Imagetools/raw/master/images/image-20200419110938271.png)

#### 43.ä»€ä¹ˆæ˜¯åŸå­æ“ä½œ

ä¸å¯è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œï¼Œå…·å¤‡åŸå­æ€§

#### 44.Javaå¦‚ä½•å®ç°åŸå­æ“ä½œ

Javaä¸­é€šè¿‡é”å’Œå¾ªç¯casçš„æ–¹å¼æ¥å®ç°åŸå­æ“ä½œï¼ŒJVMçš„CASæ“ä½œåˆ©ç”¨äº†å¤„ç†å™¨æä¾›çš„CMPXCHGæŒ‡ä»¤æ¥å®ç°çš„ã€‚è‡ªæ—‹CASå®ç°çš„åŸºæœ¬æ€è·¯å°±æ˜¯å¾ªç¯è¿›è¡ŒCASæ“ä½œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚

#### 45.CASå®ç°åŸå­æ“ä½œçš„3å¤§é—®é¢˜

ABAé—®é¢˜ï¼Œå¾ªç¯æ—¶é—´é•¿æ¶ˆè€—èµ„æºå¤§ï¼Œåªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ

#### 46.ä»€ä¹ˆæ˜¯ABAé—®é¢˜

é—®é¢˜ï¼š

å› ä¸ºcaséœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™ï¼Œæ£€æŸ¥å€¼æœ‰æ²¡æœ‰å˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–åˆ™æ›´æ–°ï¼Œå¦‚æœä¸€ä¸ªå€¼åŸæ¥æ˜¯A,å˜æˆäº†B,åˆå˜æˆäº†A,é‚£ä¹ˆä½¿ç”¨casè¿›è¡Œæ£€æµ‹æ—¶ä¼šå‘ç°å‘çš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå…¶å®æ˜¯å˜è¿‡çš„ã€‚

è§£å†³ï¼š

æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ›´æ–°çš„æ—¶å€™è¿½åŠ ç‰ˆæœ¬å·ï¼ŒA-B-A â€”> 1A-2B-3Aã€‚

ä»jdk1.5å¼€å§‹,AtomicåŒ…æä¾›äº†ä¸€ä¸ªç±»AtomicStampedReferenceæ¥è§£å†³ABAçš„é—®é¢˜ã€‚

#### 47.CASå¾ªç¯æ—¶é—´é•¿å ç”¨èµ„æºå¤§é—®é¢˜

å¦‚æœjvmèƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„pauseæŒ‡ä»¤ï¼Œé‚£ä¹ˆæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„æå‡ã€‚

ä¸€ã€å®ƒå¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤(de-pipeline),ä½¿cpuä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºå…·ä½“å®ç°çš„ç‰ˆæœ¬ï¼Œæœ‰äº›å¤„ç†å™¨å»¶è¿Ÿæ—¶é—´æ˜¯0ã€‚

äºŒã€å®ƒå¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªè€Œå¼•èµ·çš„cpuæµæ°´çº¿è¢«æ¸…ç©ºï¼Œä»è€Œæé«˜cpuæ‰§è¡Œæ•ˆç‡ã€‚

#### 48.CASåªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡åŸå­æ“ä½œ

ä¸€ã€å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¯ä»¥ç”¨é”ã€‚

äºŒã€å¯ä»¥æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚æ¯”å¦‚,x=1,k=a,åˆå¹¶xk=1aï¼Œç„¶åç”¨casæ“ä½œxkã€‚

Tips:java 1.5å¼€å§‹,jdkæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯é¥®ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œå°±å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡æ¥è¿›è¡Œcasæ“ä½œã€‚

#### 49.volatileå…³é”®å­—

volatile æ˜¯è½»é‡çº§çš„synchronized,å®ƒåœ¨å¤šå¤„ç†å™¨å¼€å‘ä¸­ä¿è¯äº†å…±äº«å˜é‡çš„ ***å¯è§æ€§*** å’Œ ***æœ‰åºæ€§***

Javaè¯­è¨€è§„èŒƒç¬¬3ç‰ˆå¯¹volatileå®šä¹‰å¦‚ä¸‹ï¼ŒJavaå…è®¸çº¿ç¨‹è®¿é—®å…±äº«å˜é‡ï¼Œä¸ºäº†ä¿è¯å…±äº«å˜é‡èƒ½å‡†ç¡®å’Œä¸€è‡´çš„æ›´æ–°ï¼Œçº¿ç¨‹åº”è¯¥ç¡®ä¿æ’å®ƒé”å•ç‹¬è·å¾—è¿™ä¸ªå˜é‡ã€‚å¦‚æœä¸€ä¸ªå­—æ®µè¢«å£°æ˜ä¸ºvolatile,Javaçº¿ç¨‹å†…å­˜æ¨¡å‹æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°è¿™ä¸ªå˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚

#### 50.ç­‰å¾…/é€šçŸ¥æœºåˆ¶

ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„å€¼ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹æ„ŸçŸ¥åˆ°äº†å˜åŒ–ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„æ“ä½œã€‚

#### 51.waitæ–¹æ³•çš„ä½œç”¨

æ–¹æ³•wait()çš„ä½œç”¨æ˜¯ä½¿å½“å‰æ‰§è¡Œä»£ç çš„çº¿ç¨‹è¿›è¡Œç­‰å¾…ï¼Œwait()æ˜¯Objectç±»é€šç”¨çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨æ¥å°†å½“å‰çº¿ç¨‹ç½®å…¥â€œé¢„æ‰§è¡Œé˜Ÿåˆ—â€ä¸­ï¼Œå¹¶åœ¨ wait()æ‰€åœ¨çš„ä»£ç å¤„åœæ­¢æ‰§è¡Œï¼Œç›´åˆ°æ¥åˆ°é€šçŸ¥æˆ–ä¸­æ–­ä¸ºæ­¢ã€‚

åœ¨è°ƒç”¨waitä¹‹å‰çº¿ç¨‹éœ€è¦è·å¾—è¯¥å¯¹è±¡çš„å¯¹è±¡çº§åˆ«çš„é”ã€‚ä»£ç ä½“ç°ä¸Šï¼Œå³åªèƒ½æ˜¯åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—å†…ã€‚è°ƒç”¨wait()åå½“å‰çº¿ç¨‹é‡Šæ”¾é”ã€‚

#### 52.notify

notify()ä¹Ÿæ˜¯Objectç±»çš„é€šç”¨æ–¹æ³•ï¼Œä¹Ÿè¦åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—å†…è°ƒç”¨ï¼Œè¯¥æ–¹æ³•ç”¨æ¥é€šçŸ¥å“ªäº›å¯èƒ½ç¯å…‰è¯¥å¯¹è±¡çš„å¯¹è±¡é”çš„å…¶ä»–çº¿ç¨‹ï¼Œå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ç­‰å¾…ï¼Œåˆ™éšæœºæŒ‘é€‰å‡ºå…¶ä¸­ä¸€ä¸ªå‘ˆwaitçŠ¶æ€çš„çº¿ç¨‹ï¼Œå¯¹å…¶å‘å‡º é€šçŸ¥ notifyï¼Œå¹¶è®©å®ƒç­‰å¾…è·å–è¯¥å¯¹è±¡çš„å¯¹è±¡é”ã€‚

#### 53.notify/notifyAll

notifyç­‰äºè¯´å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè€ŒnotifyAllæ˜¯å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…¨éƒ¨ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚

#### 54.ç­‰å¾…/é€šçŸ¥ç»å…¸èŒƒå¼

ç­‰å¾…

```java
synchronized(obj) {
		while(æ¡ä»¶ä¸æ»¡è¶³) {
				obj.wait();
		}
		// æ‰§è¡Œå¯¹åº”é€»è¾‘
}
```

é€šçŸ¥

```java
synchronized(obj) {
	//æ”¹å˜æ¡ä»¶
	obj.notifyAll();
}
```

##### 55.ThreadLocal

ä¸»è¦è§£å†³æ¯ä¸€ä¸ªçº¿ç¨‹æƒ³ç»‘å®šè‡ªå·±çš„å€¼ï¼Œå­˜æ”¾çº¿ç¨‹çš„**ç§æœ‰æ•°æ®**ã€‚

##### 56.ThreadLocalä½¿ç”¨

è·å–å½“å‰çš„çº¿ç¨‹çš„å€¼é€šè¿‡get(),è®¾ç½®set(T) æ–¹å¼æ¥è®¾ç½®å€¼ã€‚

```java
public class XKThreadLocal {

    public static ThreadLocal threadLocal = new ThreadLocal();

    public static void main(String[] args) {
        if (threadLocal.get() == null) {
            System.out.println("æœªè®¾ç½®è¿‡å€¼");
            threadLocal.set("ç§æœ‰å†…å®¹");
        }
        System.out.println(threadLocal.get());
    }

}
```

è¾“å‡º:

```tex
æœªè®¾ç½®è¿‡å€¼
ç§æœ‰å†…å®¹
```

Tips:é»˜è®¤å€¼ä¸ºnull

#### 57.è§£å†³get()è¿”å›nullé—®é¢˜

é€šè¿‡ç»§æ‰¿é‡å†™initialValue()æ–¹æ³•å³å¯ã€‚

ä»£ç å®ç°ï¼š

```java
public class ThreadLocalExt extends ThreadLocal{

    static ThreadLocalExt threadLocalExt = new ThreadLocalExt();

    @Override
    protected Object initialValue() {
        return "ç§æœ‰å†…å®¹";
    }

    public static void main(String[] args) {
        System.out.println(threadLocalExt.get());
    }
}

```

è¾“å‡ºç»“æœ:

```java
ç§æœ‰å†…å®¹
```

#### 58.Lockæ¥å£

é”å¯ä»¥é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶å…±äº«èµ„æºã€‚Java5å‰ç¨‹åºæ˜¯é synchronizedå®ç°é”åŠŸèƒ½ã€‚Java5ä¹‹åï¼Œå¹¶å‘åŒ…æ–°å¢Lockæ¥å£æ¥å®ç°é”åŠŸèƒ½ã€‚

#### 59.Lockæ¥å£æä¾› synchronizedä¸å…·å¤‡çš„ä¸»è¦ç‰¹æ€§

![image-20200419193439709](https://gitee.com/yizhibuerdai/Imagetools/raw/master/images/image-20200419193439709.png)

#### 60.é‡å…¥é” ReentrantLock

æ”¯æŒé‡è¿›å…¥çš„é”ï¼Œå®ƒè¡¨ç¤ºè¯¥é”èƒ½å¤Ÿæ”¯æŒä¸€ä¸ªçº¿ç¨‹å¯¹èµ„æºçš„é‡å¤åŠ é”ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥é”çš„è¿˜æ”¯æŒè·å–é”æ—¶çš„å…¬å¹³å’Œéå…¬å¹³æ€§é€‰æ‹©ã€‚

#### 61.é‡è¿›å…¥æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

é‡è¿›å…¥æ˜¯æŒ‡ä»»æ„çº¿ç¨‹åœ¨è·å–åˆ°é”ä¹‹åèƒ½å¤Ÿå†æ¬¡è·é”è€Œä¸è¢«é”é˜»å¡ã€‚

è¯¥ç‰¹æ€§ä¸»è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š

> 1. é”éœ€è¦å»è¯†åˆ«è·å–é”çš„çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰å æ®é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯åˆ™å†æ¬¡æˆåŠŸè·å–ã€‚

> 2. æ‰€å¾—æœ€ç»ˆé‡Šæ”¾ã€‚çº¿ç¨‹é‡å¤næ¬¡æ˜¯è·å–äº†é”ï¼Œéšååœ¨ç¬¬næ¬¡é‡Šæ”¾è¯¥é”åï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿ>è·å–åˆ°è¯¥é”ã€‚

#### 62.ReentrantLocké»˜è®¤é”ï¼Ÿ

é»˜è®¤éå…¬å¹³é”

ä»£ç ä¸ºè¯:

```java
 final boolean nonfairTryAcquire(int acquires) {
            final Thread current = Thread.currentThread();
            int c = getState();
            if (c == 0) {
                if (compareAndSetState(0, acquires)) {
                    setExclusiveOwnerThread(current);
                    return true;
                }
            }
            else if (current == getExclusiveOwnerThread()) {
                int nextc = c + acquires;
                if (nextc < 0) // overflow
                    throw new Error("Maximum lock count exceeded");
                setState(nextc);
                return true;
            }
            return false;
        }
```

#### 63.å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«

å…¬å¹³æ€§ä¸å¦é’ˆå¯¹è·å–é”æ¥è¯´çš„ï¼Œå¦‚æœä¸€ä¸ªé”æ˜¯å…¬å¹³çš„ï¼Œé‚£ä¹ˆé”çš„è·å–é¡ºåºå°±åº”è¯¥ç¬¦åˆè¯·æ±‚çš„ç»å¯¹æ—¶é—´é¡ºåºï¼Œä¹Ÿå°±æ˜¯FIFOã€‚

#### 64.è¯»å†™é”

**è¯»å†™é”å…è®¸åŒä¸€æ—¶åˆ»å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯å†™çº¿ç¨‹å’Œå…¶ä»–å†™çº¿ç¨‹å‡è¢«é˜»å¡ã€‚è¯»å†™é”ç»´æŠ¤ä¸€ä¸ªè¯»é”ä¸€ä¸ªå†™é”ï¼Œè¯»å†™åˆ†ç¦»ï¼Œå¹¶å‘æ€§å¾—åˆ°äº†æå‡**

Javaä¸­æä¾›è¯»å†™é”çš„å®ç°ç±»æ˜¯ReentrantReadWriteLockã€‚

#### 65.LockSupportå·¥å…·

å®šä¹‰äº†ä¸€ç»„å…¬å…±é™æ€æ–¹æ³•ï¼Œæä¾›äº†æœ€åŸºæœ¬çš„çº¿ç¨‹é˜»å¡å’Œå”¤é†’åŠŸèƒ½ã€‚

![image-20200419223303672](https://gitee.com/yizhibuerdai/Imagetools/raw/master/images/image-20200419223303672.png)

#### 66.Conditionæ¥å£

æä¾›äº†ç±»ä¼¼Objectç›‘è§†å™¨æ–¹æ³•ï¼Œä¸ Locké…åˆä½¿ç”¨å®ç°ç­‰å¾…/é€šçŸ¥æ¨¡å¼ã€‚

#### 67.Conditionä½¿ç”¨

ä»£ç ç¤ºä¾‹:

```java
public class XKCondition {
    Lock lock = new ReentrantLock();
    Condition cd = lock.newCondition();

    public void await() throws InterruptedException {
        lock.lock();
        try {
            cd.await();//ç›¸å½“äºObject æ–¹æ³•ä¸­çš„wait()
        } finally {
            lock.unlock();
        }
    }

    public void signal() {
        lock.lock();
        try {
            cd.signal(); //ç›¸å½“äºObject æ–¹æ³•ä¸­çš„notify()
        } finally {
            lock.unlock();
        }
    }
  
}

```

#### 68.ArrayBlockingQueue?

ä¸€ä¸ªç”±æ•°æ®æ”¯æŒçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—FIFOåŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚é˜Ÿåˆ—å¤´éƒ¨åœ¨é˜Ÿåˆ—ä¸­å­˜åœ¨çš„æ—¶é—´æœ€é•¿ï¼Œé˜Ÿåˆ—å°¾éƒ¨å­˜åœ¨æ—¶é—´æœ€çŸ­ã€‚

#### 69.PriorityBlockingQueue?

ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œä½†å®ƒä¸ä¼šé˜»å¡æ•°æ®ç”Ÿäº§è€…ï¼Œè€Œåªä¼šåœ¨æ²¡æœ‰å¯æ¶ˆè´¹çš„æ•°æ®æ—¶ï¼Œé˜»å¡æ•°æ®çš„æ¶ˆè´¹è€…ã€‚

#### 70.DelayQueue?

æ˜¯ä¸€ä¸ªæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç°Delayedæ¥å£å’Œ Comparableæ¥å£ï¼Œåœ¨åˆ›å»ºå…ƒç´ æ—¶å¯ä»¥æŒ‡å®šå¤šä¹…æ‰èƒ½ä»é˜Ÿåˆ—ä¸­è·å–å½“å‰å…ƒç´ ã€‚

#### 71.Javaå¹¶å‘å®¹å™¨ï¼Œä½ çŸ¥é“å‡ ä¸ªï¼Ÿ

ConcurrentHashMapã€CopyOnWriteArrayList ã€CopyOnWriteArraySet ã€ConcurrentLinkedQueueã€

ConcurrentLinkedDequeã€ConcurrentSkipListMapã€ConcurrentSkipListSetã€ArrayBlockingQueueã€

LinkedBlockingQueueã€LinkedBlockingDequeã€PriorityBlockingQueueã€SynchronousQueueã€

LinkedTransferQueueã€DelayQueue

#### 72.ConcurrentHashMap

å¹¶å‘å®‰å…¨ç‰ˆHashMap,java7ä¸­é‡‡ç”¨åˆ†æ®µé”æŠ€æœ¯æ¥æé«˜å¹¶å‘æ•ˆç‡ï¼Œé»˜è®¤åˆ†16æ®µã€‚Java8æ”¾å¼ƒäº†åˆ†æ®µé”ï¼Œé‡‡ç”¨CASï¼ŒåŒæ—¶å½“å“ˆå¸Œå†²çªæ—¶ï¼Œå½“é“¾è¡¨çš„é•¿åº¦åˆ°8æ—¶ï¼Œä¼šè½¬åŒ–æˆçº¢é»‘æ ‘ã€‚ï¼ˆå¦‚éœ€äº†è§£ç»†èŠ‚ï¼Œè§jdkä¸­ä»£ç ï¼‰

#### 73.ConcurrentLinkedQueue

åŸºäºé“¾æ¥èŠ‚ç‚¹çš„æ— ç•Œçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ï¼Œå®ƒé‡‡ç”¨å…ˆè¿›å…ˆå‡ºçš„è§„åˆ™å¯¹èŠ‚ç‚¹è¿›è¡Œæ’åºï¼Œå½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå®ƒä¼šæ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œå½“æˆ‘ä»¬è·å–ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒä¼šè¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ã€‚å®ƒé‡‡ç”¨casç®—æ³•æ¥å®ç°ã€‚ï¼ˆå¦‚éœ€äº†è§£ç»†èŠ‚ï¼Œè§jdkä¸­ä»£ç ï¼‰

#### 74.ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿ

é˜»å¡é˜Ÿåˆ—æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ï¼Œè¿™ä¸¤ä¸ªé™„åŠ æ“ä½œæ”¯æŒé˜»å¡çš„æ’å…¥å’Œç§»é™¤æ–¹æ³•ã€‚

1ã€æ”¯æŒé˜»å¡çš„æ’å…¥æ–¹æ³•ï¼šå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡æ’å…¥å…ƒç´ çš„çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸æ»¡ã€‚

2ã€æ”¯æŒé˜»å¡çš„ç§»é™¤æ–¹æ³•ï¼šå½“é˜Ÿåˆ—ç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚

#### 75.é˜»å¡é˜Ÿåˆ—å¸¸ç”¨çš„åº”ç”¨åœºæ™¯ï¼Ÿ

å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œå–å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—æ­£å¥½æ˜¯ç”Ÿäº§è€…å­˜æ”¾ã€æ¶ˆè´¹è€…æ¥è·å–çš„å®¹å™¨ã€‚

#### 76.Javaé‡Œçš„é˜»å¡çš„é˜Ÿåˆ—

```tex
ArrayBlockingQueueï¼š    æ•°ç»„ç»“æ„ç»„æˆçš„ |æœ‰ç•Œé˜»å¡é˜Ÿåˆ—
LinkedBlockingQueueï¼š   é“¾è¡¨ç»“æ„ç»„æˆçš„|æœ‰ç•Œé˜»å¡é˜Ÿåˆ—
PriorityBlockingQueue:  æ”¯æŒä¼˜å…ˆçº§æ’åº|æ— ç•Œé˜»å¡é˜Ÿåˆ—
DelayQueueï¼š            ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°|æ— ç•Œé˜»å¡é˜Ÿåˆ—
SynchronousQueueï¼š      ä¸å­˜å‚¨å…ƒç´ | é˜»å¡é˜Ÿåˆ—
LinkedTransferQueueï¼š   é“¾è¡¨ç»“æ„ç»„æˆ|æ— ç•Œé˜»å¡é˜Ÿåˆ—
LinkedBlockingDequeï¼š   é“¾è¡¨ç»“æ„ç»„æˆ|åŒå‘é˜»å¡é˜Ÿåˆ—
```

#### 77.Fork/Join

java7æä¾›çš„ä¸€ä¸ªç”¨äºå¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„æ¡†æ¶ï¼ŒæŠŠä¸€ä¸ªå¤§ä»»åŠ¡åˆ†å‰²æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼Œæœ€ç»ˆæ±‡æ€»æ¯ä¸ªå°ä»»åŠ¡ç»“æœçš„åå¾—åˆ°å¤§ä»»åŠ¡ç»“æœçš„æ¡†æ¶ã€‚

#### 78.å·¥ä½œçªƒå–ç®—æ³•

æ˜¯æŒ‡æŸä¸ªçº¿ç¨‹ä»å…¶ä»–é˜Ÿåˆ—é‡Œçªƒå–ä»»åŠ¡æ¥æ‰§è¡Œã€‚å½“å¤§ä»»åŠ¡è¢«åˆ†å‰²æˆå°ä»»åŠ¡æ—¶ï¼Œæœ‰çš„çº¿ç¨‹å¯èƒ½æå‰å®Œæˆä»»åŠ¡ï¼Œæ­¤æ—¶é—²ç€ä¸å¦‚å»å¸®å…¶ä»–æ²¡å®Œæˆå·¥ä½œçº¿ç¨‹ã€‚æ­¤æ—¶å¯ä»¥å»å…¶ä»–é˜Ÿåˆ—çªƒå–ä»»åŠ¡ï¼Œä¸ºäº†å‡å°‘ç«äº‰ï¼Œé€šå¸¸ä½¿ç”¨åŒç«¯é˜Ÿåˆ—ï¼Œè¢«çªƒå–çš„çº¿ç¨‹ä»å¤´éƒ¨æ‹¿ï¼Œçªƒå–çš„çº¿ç¨‹ä»å°¾éƒ¨æ‹¿ä»»åŠ¡æ‰§è¡Œã€‚

#### 79.å·¥ä½œçªƒå–ç®—æ³•çš„æœ‰ç¼ºç‚¹

ä¼˜ç‚¹ï¼šå……åˆ†åˆ©ç”¨çº¿ç¨‹è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œå‡å°‘äº†çº¿ç¨‹é—´çš„ç«äº‰ã€‚

ç¼ºç‚¹ï¼šæœ‰äº›æƒ…å†µä¸‹è¿˜æ˜¯å­˜åœ¨ç«äº‰ï¼Œæ¯”å¦‚åŒç«¯é˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªä»»åŠ¡ã€‚è¿™æ ·å°±æ¶ˆè€—äº†æ›´å¤šèµ„æºã€‚

#### 80.Javaä¸­åŸå­æ“ä½œæ›´æ–°åŸºæœ¬ç±»å‹ï¼ŒAtomicåŒ…æä¾›äº†å“ªå‡ ä¸ªç±»?

AtomicBoolean:åŸå­æ›´æ–°å¸ƒå°”ç±»å‹

AtomicInteger:åŸå­æ›´æ–°æ•´å½¢

AtomicLong:åŸå­æ›´æ–°é•¿æ•´å½¢

#### 81.Javaä¸­åŸå­æ“ä½œæ›´æ–°æ•°ç»„ï¼ŒAtomicåŒ…æä¾›äº†å“ªå‡ ä¸ªç±»?

AtomicIntegerArray:       åŸå­æ›´æ–°æ•´å½¢æ•°æ®é‡Œçš„å…ƒç´ 

AtomicLongArray:          åŸå­æ›´æ–°é•¿æ•´å½¢æ•°ç»„é‡Œçš„å…ƒç´ 

AtomicReferenceArray:  åŸå­æ›´æ–°é¥®ç”¨ç±»å‹æ•°ç»„é‡Œçš„å…ƒç´ 

AtomicIntegerArray:      ä¸»è¦æä¾›åŸå­æ–¹å¼æ›´æ–°æ•°ç»„é‡Œçš„æ•´å½¢

#### 82.Javaä¸­åŸå­æ“ä½œæ›´æ–°å¼•ç”¨ç±»å‹ï¼ŒAtomicåŒ…æä¾›äº†å“ªå‡ ä¸ªç±»?

å¦‚æœåŸå­éœ€è¦æ›´æ–°å¤šä¸ªå˜é‡ï¼Œå°±éœ€è¦ç”¨å¼•ç”¨ç±»å‹äº†ã€‚

AtomicReference :  åŸå­æ›´æ–°å¼•ç”¨ç±»å‹

AtomicReferenceFieldUpdater: åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µã€‚

AtomicMarkableReference: åŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹ã€‚æ ‡è®°ä½ç”¨booleanç±»å‹è¡¨ç¤ºï¼Œæ„é€ æ–¹æ³•æ—¶AtomicMarkableReference(V initialRef,boolean initialMark)

#### 83.Javaä¸­åŸå­æ“ä½œæ›´æ–°å­—æ®µç±»ï¼ŒAtomicåŒ…æä¾›äº†å“ªå‡ ä¸ªç±»?

AtomiceIntegerFieldUpdater:  	åŸå­æ›´æ–°æ•´å½¢å­—æ®µçš„æ›´æ–°å™¨

AtomiceLongFieldUpdater:     	åŸå­æ›´æ–°é•¿æ•´å½¢å­—æ®µçš„æ›´æ–°å™¨

AtomiceStampedFieldUpdater:   åŸå­æ›´æ–°å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ï¼Œå°†æ•´æ•°å€¼

#### 84.JDKå¹¶å‘åŒ…ä¸­æä¾›äº†å“ªå‡ ä¸ªæ¯”è¾ƒå¸¸è§çš„å¤„ç†å¹¶å‘çš„å·¥å…·ç±»ï¼Ÿ

æä¾›å¹¶å‘æ§åˆ¶æ‰‹æ®µ: CountDownLatchã€CyclicBarrierã€Semaphore

çº¿ç¨‹é—´æ•°æ®äº¤æ¢:     Exchanger

#### 85.CountDownLatch

å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œã€‚

CountDownLatchçš„æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªintç±»å‹çš„å‚æ•°ä½œä¸ºè®¡æ•°å™¨ï¼Œä½ æƒ³ç­‰å¾…nä¸ªç‚¹å®Œæˆï¼Œå°±ä¼ å…¥nã€‚

ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•:

countDown() : è°ƒç”¨æ—¶ï¼Œnä¼šå‡1ã€‚

await() : è°ƒç”¨ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°nå˜æˆ0ã€‚

await(long time,TimeUnit unit) : ç­‰å¾…ç‰¹å®šæ—¶é—´åï¼Œå°±ä¸ä¼šç»§ç»­é˜»å¡å½“å‰çº¿ç¨‹ã€‚

tips:è®¡æ•°å™¨å¿…é¡»å¤§äºç­‰äº0ï¼Œå½“ä¸º0æ—¶ï¼Œawaitå°±ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚

ä¸æä¾›é‡æ–°åˆå§‹åŒ–æˆ–ä¿®æ”¹å†…éƒ¨è®¡æ•°å™¨çš„å€¼çš„åŠŸèƒ½ã€‚

#### 86.CyclicBarrier

å¯å¾ªç¯ä½¿ç”¨çš„å±éšœã€‚

è®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­è¿è¡Œã€‚

CyclicBarrieré»˜è®¤æ„é€ æ”¾æ—¶CyclicBarrier(int parities) ,å…¶å‚æ•°è¡¨ç¤ºå±éšœæ‹¦æˆªçš„çº¿ç¨‹æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•å‘Šè¯‰CyclicBarrieræˆ‘å·²ç»åˆ°è¾¾å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡ã€‚

#### 87.CountDownLatchä¸CyclicBarrieråŒºåˆ«

CountDownLatchï¼š

è®¡æ•°å™¨ï¼šè®¡æ•°å™¨åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚

ç­‰å¾…ï¼š ä¸€ä¸ªçº¿ç¨‹æˆ–å¤šä¸ªç­‰å¾…å¦å¤–nä¸ªçº¿ç¨‹å®Œæˆä¹‹åæ‰èƒ½æ‰§è¡Œã€‚

CyclicBarrierï¼š

è®¡æ•°å™¨ï¼šè®¡æ•°å™¨å¯ä»¥é‡ç½®ï¼ˆé€šè¿‡reset()æ–¹æ³•)ã€‚

ç­‰å¾…ï¼š nä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…ï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹å®Œæˆä¹‹å‰ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ã€‚

#### 88.Semaphore

ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®èµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œé€šè¿‡åè°ƒå„ä¸ªçº¿ç¨‹ï¼Œæ¥ä¿è¯åˆç†çš„å…¬å…±èµ„æºçš„è®¿é—®ã€‚

åº”ç”¨åœºæ™¯ï¼šæµé‡æ§åˆ¶ï¼Œç‰¹åˆ«æ˜¯å…¬å…±èµ„æºæœ‰é™çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚æ•°æ®é“¾æ¥ï¼Œé™æµç­‰ã€‚

#### 89.Exchanger

Exchangeræ˜¯ä¸€ä¸ªç”¨äºçº¿ç¨‹é—´åä½œçš„å·¥å…·ç±»ï¼Œå®ƒæä¾›ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œåœ¨è¿™ä¸ªåŒæ­¥ç‚¹ä¸Šï¼Œä¸¤ä¸ªçº¿ç¨‹å¯ä»¥äº¤æ¢å½¼æ­¤çš„æ•°æ®ã€‚æ¯”å¦‚ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œexchange()æ–¹æ³•ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿæ‰§è¡Œexchangeï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½åˆ°åŒæ­¥ç‚¹ï¼Œå°±å¯ä»¥äº¤æ¢æ•°æ®äº†ã€‚

ä¸€èˆ¬æ¥è¯´ä¸ºäº†é¿å…ä¸€ç›´ç­‰å¾…çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨exchange(V x,long timeout,TimeUnit unit),è®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´ã€‚

Exchangerå¯ä»¥ç”¨äºé—ä¼ ç®—æ³•ã€‚

#### 90.ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹æ± 

å‡ ä¹æ‰€æœ‰éœ€è¦å¼‚æ­¥æˆ–è€…å¹¶å‘æ‰§è¡Œä»»åŠ¡çš„ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± ã€‚åˆç†ä½¿ç”¨ä¼šç»™æˆ‘ä»¬å¸¦æ¥ä»¥ä¸‹å¥½å¤„ã€‚

- é™ä½ç³»ç»Ÿæ¶ˆè€—ï¼šé‡å¤åˆ©ç”¨å·²ç»åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„èµ„æºæ¶ˆè€—ã€‚
- æé«˜å“åº”é€Ÿåº¦ï¼š å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±å¯ä»¥ç«‹å³æ‰§è¡Œã€‚
- æä¾›çº¿ç¨‹å¯ä»¥ç®¡ç†æ€§ï¼š å¯ä»¥é€šè¿‡è®¾ç½®åˆç†åˆ†é…ã€è°ƒä¼˜ã€ç›‘æ§ã€‚

#### 91.çº¿ç¨‹æ± å·¥ä½œæµç¨‹

1ã€åˆ¤æ–­æ ¸å¿ƒçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ˜¯å¦éƒ½æœ‰åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå¦->åˆ›å»ºä¸€ä¸ªæ–°å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚æ˜¯->èµ°ä¸‹ä¸ªæµç¨‹ã€‚

2ã€åˆ¤æ–­å·¥ä½œé˜Ÿåˆ—æ˜¯å¦å·²æ»¡ï¼Œå¦->æ–°ä»»åŠ¡å­˜å‚¨åœ¨è¿™ä¸ªå·¥ä½œé˜Ÿåˆ—é‡Œï¼Œæ˜¯->èµ°ä¸‹ä¸ªæµç¨‹ã€‚

3ã€åˆ¤æ–­çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ˜¯å¦éƒ½åœ¨å·¥ä½œçŠ¶æ€ï¼Œå¦->åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œæ˜¯->èµ°ä¸‹ä¸ªæµç¨‹ã€‚

4ã€æŒ‰ç…§è®¾ç½®çš„ç­–ç•¥æ¥å¤„ç†æ— æ³•æ‰§è¡Œçš„ä»»åŠ¡ã€‚

#### 92.åˆ›å»ºçº¿ç¨‹æ± å‚æ•°æœ‰å“ªäº›ï¼Œä½œç”¨ï¼Ÿ

```java
 public ThreadPoolExecutor(   int corePoolSize,
                              int maximumPoolSize,
                              long keepAliveTime,
                              TimeUnit unit,
                              BlockingQueue<Runnable> workQueue,
                              ThreadFactory threadFactory,
                              RejectedExecutionHandler handler)
```

1.corePoolSize:æ ¸å¿ƒçº¿ç¨‹æ± å¤§å°ï¼Œå½“æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå³ä½¿å…¶ä»–ç©ºé—²çš„æ ¸å¿ƒçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°ä»»åŠ¡ä¹Ÿä¼šåˆ›å»ºï¼Œç­‰å¾…éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°å¤§äºçº¿ç¨‹æ ¸å¿ƒå¤§å°å°±ä¸ä¼šç»§ç»­åˆ›å»ºã€‚

2.maximumPoolSize:çº¿ç¨‹æ± æœ€å¤§æ•°ï¼Œå…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å·²ç»åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœæ˜¯æ— ç•Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªå‚æ•°åŸºæœ¬æ²¡ç”¨ã€‚

3.keepAliveTime: çº¿ç¨‹ä¿æŒæ´»åŠ¨æ—¶é—´ï¼Œçº¿ç¨‹æ± å·¥ä½œçº¿ç¨‹ç©ºé—²åï¼Œä¿æŒå­˜æ´»çš„æ—¶é—´ï¼Œæ‰€ä»¥å¦‚æœä»»åŠ¡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒçŸ­ï¼Œå¯ä»¥è°ƒå¤§æ—¶é—´ï¼Œæé«˜çº¿ç¨‹åˆ©ç”¨ç‡ã€‚

4.unit: çº¿ç¨‹ä¿æŒæ´»åŠ¨æ—¶é—´å•ä½ï¼Œå¤©ï¼ˆDAYS)ã€å°æ—¶(HOURS)ã€åˆ†é’Ÿ(MINUTESã€æ¯«ç§’MILLISECONDS)ã€å¾®ç§’(MICROSECONDS)ã€çº³ç§’(NANOSECONDS)

5.workQueue: ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚

ä¸€èˆ¬æ¥è¯´å¯ä»¥é€‰æ‹©å¦‚ä¸‹é˜»å¡é˜Ÿåˆ—ï¼š

    - ArrayBlockingQueue:åŸºäºæ•°ç»„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚
    - LinkedBlockingQueue:åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ã€‚
    - SynchronizedQueue:ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚
    - PriorityBlockingQueue:ä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„é˜»å¡é˜Ÿåˆ—ã€‚

6.threadFactoryï¼šè®¾ç½®åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®æ›´æœ‰æ„ä¹‰çš„åå­—ã€‚

7. handler: é¥±å’Œç­–ç•¥ä¹Ÿå«æ‹’ç»ç­–ç•¥ã€‚å½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œå³è¾¾åˆ°é¥±å’ŒçŠ¶æ€ã€‚æ‰€ä»¥éœ€è¦é‡‡å–ç­–ç•¥æ¥å¤„ç†æ–°çš„ä»»åŠ¡ã€‚é»˜è®¤ç­–ç•¥æ˜¯AbortPolicyã€‚

   - AbortPolicy:ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚
   - CallerRunsPolicy: è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡ã€‚
   - DiscardOldestPolicy:ä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ã€‚
   - DiscardPolicy:ä¸å¤„ç†ï¼Œç›´æ¥ä¸¢æ‰ã€‚

   å½“ç„¶å¯ä»¥æ ¹æ®è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œå®ç°RejectedExecutionHandleræ¥å£è‡ªå®šä¹‰ç­–ç•¥ã€‚

#### 93.å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡

å¯ä»¥ä½¿ç”¨execute()å’Œsubmit() ä¸¤ç§æ–¹å¼æäº¤ä»»åŠ¡ã€‚

execute():æ— è¿”å›å€¼ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«æ‰§è¡ŒæˆåŠŸã€‚

submit():ç”¨äºæäº¤éœ€è¦æœ‰è¿”å›å€¼çš„ä»»åŠ¡ã€‚çº¿ç¨‹æ± è¿”å›ä¸€ä¸ªfutureç±»å‹çš„å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªfutureå¯¹è±¡å¯ä»¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡futureçš„get()æ¥è·å–è¿”å›å€¼ï¼Œget()æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹çŸ¥é“ä»»åŠ¡å®Œæˆã€‚get(long timeout,TimeUnit unit)å¯ä»¥è®¾ç½®è¶…å¸‚æ—¶é—´ã€‚

#### 94.å…³é—­çº¿ç¨‹æ± 

å¯ä»¥é€šè¿‡shutdown()æˆ–shutdownNow()æ¥å…³é—­çº¿ç¨‹æ± ã€‚å®ƒä»¬çš„åŸç†æ˜¯éå†çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ï¼Œç„¶åé€ä¸ªè°ƒç”¨çº¿ç¨‹çš„interruptæ¥ä¸­æ–­çº¿ç¨‹ï¼Œæ‰€ä»¥æ— æ³•å“åº”ç»ˆç«¯çš„ä»»åŠ¡å¯ä»¥èƒ½æ°¸è¿œæ— æ³•åœæ­¢ã€‚

shutdownNowé¦–å…ˆå°†çº¿ç¨‹æ± çŠ¶æ€è®¾ç½®æˆSTOP,ç„¶åå°è¯•åœæ­¢æ‰€æœ‰çš„æ­£åœ¨æ‰§è¡Œæˆ–è€…æš‚åœçš„çº¿ç¨‹ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„åˆ—è¡¨ã€‚

shutdownåªæ˜¯å°†çº¿ç¨‹æ± çš„çŠ¶æ€è®¾ç½®æˆshutdownçŠ¶æ€ï¼Œç„¶åä¸­æ–­æ‰€æœ‰æ²¡æœ‰æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ã€‚

åªè¦è°ƒç”¨ä¸¤è€…ä¹‹ä¸€ï¼ŒisShutdownå°±ä¼šè¿”å›true,å½“æ‰€æœ‰ä»»åŠ¡éƒ½å·²å…³é—­ï¼ŒisTerminaedå°±ä¼šè¿”å›trueã€‚

ä¸€èˆ¬æ¥è¯´è°ƒç”¨shutdownæ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ï¼Œå¦‚æœä»»åŠ¡ä¸ä¸€å®šè¦æ‰§è¡Œå®Œï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨shutdownNowæ–¹æ³•ã€‚

#### 95.çº¿ç¨‹æ± å¦‚ä½•åˆç†è®¾ç½®

é…ç½®çº¿ç¨‹æ± å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è€ƒè™‘ã€‚

- ä»»åŠ¡æ˜¯cpuå¯†é›†å‹ã€IOå¯†é›†å‹æˆ–è€…æ··åˆå‹
- ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œé«˜ä¸­ä½ã€‚
- ä»»åŠ¡æ—¶é—´æ‰§è¡Œé•¿çŸ­ã€‚
- ä»»åŠ¡ä¾èµ–æ€§ï¼šæ˜¯å¦ä¾èµ–å…¶ä»–ç³»ç»Ÿèµ„æºã€‚

  - cpuå¯†é›†å‹å¯ä»¥é…ç½®å¯èƒ½å°çš„çº¿ç¨‹,æ¯”å¦‚ n + 1ä¸ªçº¿ç¨‹ã€‚
  - ioå¯†é›†å‹å¯ä»¥é…ç½®è¾ƒå¤šçš„çº¿ç¨‹ï¼Œå¦‚ 2nä¸ªçº¿ç¨‹ã€‚
  - æ··åˆå‹å¯ä»¥æ‹†æˆioå¯†é›†å‹ä»»åŠ¡å’Œcpuå¯†é›†å‹ä»»åŠ¡ï¼Œ

  å¦‚æœä¸¤ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´ç›¸å·®å¤§ï¼Œå¦->åˆ†è§£åæ‰§è¡Œååé‡å°†é«˜äºä¸²è¡Œæ‰§è¡Œååé‡ã€‚æ˜¯->æ²¡å¿…è¦åˆ†è§£ã€‚

  å¯ä»¥é€šè¿‡Runtime.getRuntime().availableProcessors()æ¥è·å–cpuä¸ªæ•°ã€‚

  å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œå¢åŠ ç³»ç»Ÿçš„é¢„è­¦èƒ½åŠ›å’Œç¨³å®šæ€§ã€‚

#### 96.Executor

ä»JDK5å¼€å§‹ï¼ŒæŠŠå·¥ä½œå•å…ƒå’Œæ‰§è¡Œæœºåˆ¶åˆ†å¼€ã€‚å·¥ä½œå•å…ƒåŒ…æ‹¬Runnableå’ŒCallable,è€Œæ‰§è¡Œæœºåˆ¶ç”±Executoræ¡†æ¶æä¾›ã€‚

#### 97.Executoræ¡†æ¶çš„ä¸»è¦æˆå‘˜

ThreadPoolExecutor  :å¯ä»¥é€šè¿‡å·¥å‚ç±»Executorsæ¥åˆ›å»ºã€‚

å¯ä»¥åˆ›å»º3ç§ç±»å‹çš„ThreadPoolExecutorï¼šSingleThreadExecutorã€FixedThreadPoolã€CachedThreadPoolã€‚

ScheduledThreadPoolExecutor ï¼šå¯ä»¥é€šè¿‡å·¥å‚ç±»Executorsæ¥åˆ›å»ºã€‚

å¯ä»¥åˆ›å»º2ä¸­ç±»å‹çš„ScheduledThreadPoolExecutorï¼šScheduledThreadPoolExecutorã€SingleThreadScheduledExecutor

Futureæ¥å£:Futureå’Œå®ç°Futureæ¥å£çš„FutureTaskç±»æ¥è¡¨ç¤ºå¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚

Runnableå’ŒCallable:å®ƒä»¬çš„æ¥å£å®ç°ç±»éƒ½å¯ä»¥è¢«ThreadPoolExecutoræˆ–ScheduledThreadPoolExecutoræ‰§è¡Œã€‚Runnableä¸èƒ½è¿”å›ç»“æœï¼ŒCallableå¯ä»¥è¿”å›ç»“æœã€‚

#### 98.FixedThreadPool

å¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ã€‚

æŸ¥çœ‹æºç ï¼š

```java
public static ExecutorService newFixedThreadPool(int nThreads) {
   return new ThreadPoolExecutor(nThreads, nThreads,
                                 0L, TimeUnit.MILLISECONDS,
                                new LinkedBlockingQueue<Runnable>());}
```

corePoolSize å’ŒmaxPoolSizeéƒ½è¢«è®¾ç½®æˆæˆ‘ä»¬è®¾ç½®çš„nThreadsã€‚

å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äºcorePoolSize ,keepAliveTimeä¸ºå¤šä½™çš„ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´åå¤šä½™çš„çº¿ç¨‹å°†è¢«ç»ˆæ­¢ï¼Œå¦‚æœè®¾ä¸º0ï¼Œè¡¨ç¤ºå¤šä½™çš„ç©ºé—²çº¿ç¨‹ä¼šç«‹å³ç»ˆæ­¢ã€‚

å·¥ä½œæµç¨‹ï¼š

> 1. å½“å‰çº¿ç¨‹å°‘äºcorePoolSize,åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚

> 2. å½“å‰è¿è¡Œçº¿ç¨‹ç­‰äºcorePoolSize,å°†ä»»åŠ¡åŠ å…¥LinkedBlockingQueueã€‚

> 3. çº¿ç¨‹æ‰§è¡Œå®Œ1ä¸­çš„ä»»åŠ¡ï¼Œä¼šå¾ªç¯åå¤ä»LinkedBlockingQueueè·å–ä»»åŠ¡æ¥æ‰§è¡Œã€‚

LinkedBlockingQueueä½œä¸ºçº¿ç¨‹æ± å·¥ä½œé˜Ÿåˆ—ï¼ˆé»˜è®¤å®¹é‡Integer.MAX_VALUE)ã€‚å› æ­¤å¯èƒ½ä¼šé€ æˆå¦‚ä¸‹ç»“æœï¼š

> 1. å½“çº¿ç¨‹æ•°ç­‰äºcorePoolSizeæ—¶ï¼Œæ–°ä»»åŠ¡å°†åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œå› ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹**ä¸ä¼šè¶…è¿‡**corePoolSizeã€‚

> 2. **maxnumPoolSizeç­‰äºè¯´æ˜¯ä¸€ä¸ªæ— æ•ˆå‚æ•°**

> 3. **keepAliveTimeç­‰äºè¯´ä¹Ÿæ˜¯ä¸€ä¸ªæ— æ•ˆå‚æ•°**

> 4. è¿è¡Œä¸­çš„FixedThreadPool(æœªæ‰§è¡Œshundownæˆ–shundownNow))åˆ™ä¸ä¼šè°ƒç”¨æ‹’ç»ç­–ç•¥ã€‚

![çº¿ç¨‹æ± å¤ç”¨åŸç†æµç¨‹å›¾](https://raw.githubusercontent.com/qinguan1/qinguan1.github.io/main/docs/assets/img/qinguan/çº¿ç¨‹æ± å¤ç”¨åŸç†æµç¨‹å›¾.png)

> 5. **ç”±äºä»»åŠ¡å¯ä»¥ä¸åœçš„åŠ åˆ°é˜Ÿåˆ—ï¼Œå½“ä»»åŠ¡è¶Šæ¥è¶Šå¤šæ—¶å¾ˆå®¹æ˜“é€ æˆOOM**

#### 99.SingleThreadExecutor

æ˜¯ä½¿ç”¨å•ä¸ªworkerçº¿ç¨‹çš„Executorã€‚

æŸ¥çœ‹æºç ï¼š

```java
public static ExecutorService newSingleThreadExecutor() {
        return new FinalizableDelegatedExecutorService
            (new ThreadPoolExecutor(1, 1,
                                    0L, TimeUnit.MILLISECONDS,
                                    new LinkedBlockingQueue<Runnable>()));
    }
```

corePoolSizeå’ŒmaxnumPoolSizeè¢«è®¾ç½®ä¸º1ã€‚å…¶ä»–å‚æ•°å’ŒFixedThreadPoolç›¸åŒã€‚

æ‰§è¡Œæµç¨‹ä»¥åŠé€ æˆçš„å½±å“åŒFixedThreadPool.

#### 100.CachedThreadPool

æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚

æŸ¥çœ‹æºç ï¼š

```java
    public static ExecutorService newCachedThreadPool() {
        return new ThreadPoolExecutor(0, Integer.MAX_VALUE,
                                      60L, TimeUnit.SECONDS,
                                      new SynchronousQueue<Runnable>());
```

corePoolSizeè®¾ç½®ä¸º0ï¼ŒmaxmumPoolSizeä¸ºInteger.MAX_VALUEã€‚keepAliveTimeä¸º60ç§’ã€‚

å·¥ä½œæµç¨‹ï¼š

1.é¦–å…ˆæ‰§è¡ŒSynchronousQueue.offer (Runnable task)ã€‚å¦‚æœå½“å‰maximumPool ä¸­æœ‰ç©ºé—²çº¿ç¨‹æ­£åœ¨æ‰§è¡ŒS ynchronousQueue.poll(keepAliveTIme,TimeUnit.NANOSECONDS)ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹æ‰§è¡Œofferæ“ä½œä¸ç©ºé—²çº¿ç¨‹æ‰§è¡Œçš„pollæ“ä½œé…å¯¹æˆåŠŸï¼Œä¸»çº¿ç¨‹æŠŠä»»åŠ¡äº¤ç»™ç©ºé—²çº¿ç¨‹æ‰§è¡Œ,executeæ–¹ æ³•æ‰§è¡Œå®Œæˆ;å¦åˆ™æ‰§è¡Œä¸‹é¢çš„æ­¥éª¤2ã€‚

2. å½“åˆå§‹maximumPoolä¸ºç©ºæˆ–è€…maximumPoolä¸­å½“å‰æ²¡æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œå°†æ²¡æœ‰çº¿ç¨‹æ‰§è¡Œ SynchronousQueue.poll (keepAliveTimeï¼ŒTimeUnit.NANOSECONDS)ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¥éª¤ 1å°†å¤± è´¥ã€‚æ­¤æ—¶CachedThreadPoolä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œexecute()æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚

3.åœ¨æ­¥éª¤2ä¸­æ–°åˆ›å»ºçš„çº¿ç¨‹å°†ä»»åŠ¡æ‰§è¡Œå®Œåï¼Œä¼šæ‰§è¡ŒSynchronousQueue.poll (keepAliveTimeï¼ŒTimeUnit.NANOSECONDS)ã€‚è¿™ä¸ªpollæ“ä½œä¼šè®©ç©ºé—²çº¿ç¨‹æœ€å¤šåœ¨SynchronousQueueä¸­ç­‰å¾…60ç§’é’Ÿã€‚å¦‚æœ60ç§’é’Ÿå†…ä¸»çº¿ç¨‹æäº¤äº†ä¸€ä¸ªæ–°ä»»åŠ¡(ä¸»çº¿ç¨‹æ‰§è¡Œæ­¥éª¤1)ï¼Œé‚£ä¹ˆè¿™ä¸ªç©ºé—²çº¿ç¨‹å°†æ‰§è¡Œä¸»çº¿ç¨‹æäº¤çš„æ–°ä»»åŠ¡;å¦åˆ™ï¼Œè¿™ä¸ªç©ºé—²çº¿ç¨‹å°†ç»ˆæ­¢ã€‚ç”±äºç©ºé—²60ç§’çš„ç©ºé—²çº¿ç¨‹ä¼šè¢«ç»ˆæ­¢,å› æ­¤é•¿æ—¶é—´ä¿æŒç©ºé—²çš„CachedThreadPoolä¸ä¼šä½¿ç”¨ä»»ä½•èµ„æºã€‚

ä¸€èˆ¬æ¥è¯´å®ƒé€‚åˆå¤„ç†æ—¶é—´çŸ­ã€å¤§é‡çš„ä»»åŠ¡ã€‚

å‚è€ƒï¼š

- ã€ŠJavaå¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯ã€‹
- ã€ŠJavaé«˜å¹¶å‘ç¼–ç¨‹è¯¦è§£ã€‹
- ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹
